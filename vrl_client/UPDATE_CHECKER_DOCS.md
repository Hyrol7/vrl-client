# 📦 UPDATE_CHECKER.PY - ДЕТАЛЬНА ДОКУМЕНТАЦІЯ

## ❓ Основні питання

### 1️⃣ Він запускається коли? При завантаженні програми?

**ВІДПОВІДЬ: НІ, запускається ВРУЧНУ**

```
┌─────────────────────────────────────────────────────────┐
│ РОЗПОВСЮДЖУВАЧ                                          │
├─────────────────────────────────────────────────────────┤
│ 1. Користувач запускає VRL_Client.exe                   │
│    ↓                                                    │
│ 2. vrl.py виконується (ініціалізація + ping loop)      │
│    ↓                                                    │
│ 3. Програма працює без перевірки оновлень              │
│    (update_checker.py НЕ запускається автоматично)     │
│                                                         │
│ КОРИСТУВАЧ ВРУЧНУ (коли хочет):                         │
│ python update_checker.py     # Перевірити оновлення     │
└─────────────────────────────────────────────────────────┘
```

**ЧОМУ?**
- Перевірка оновлень потребує інтернету (не всі мають)
- Не хочемо затримувати запуск програми
- Користувачі самі вирішують коли перевіряти
- На виробництві часто відключають інтернет-запити

---

### 2️⃣ Що саме він перевіряє? Файли py чи сам exe?

**ВІДПОВІДЬ: Перевіряє ТІЛЬКИ exe файл на GitHub Releases**

```
┌─────────────────────────────────────────────────────────┐
│ ЩО ПЕРЕВІРЯЄТЬСЯ                                        │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ ❌ НЕ перевіряє:                                        │
│   - .py файли (parser.py, analyser.py, тощо)          │
│   - Вихідний код на GitHub                             │
│   - Конфіг або БД                                      │
│                                                         │
│ ✅ ПЕРЕВІРЯЄ:                                           │
│   - VRL_Client.exe на GitHub Releases                  │
│   - Версію тега (v0.1.0, v0.2.0, тощо)                │
│   - Розмір файлу                                       │
│   - Release notes (що нового)                          │
│                                                         │
└─────────────────────────────────────────────────────────┘

СЦЕНАРІЙ:

LOCAL_VERSION = "0.1.0"  (в update_checker.py жорстко закодована)
                         ↓
GITHUB release: v0.2.0 = VRL_Client.exe (новіший!)
                         ↓
РЕЗУЛЬТАТ: "ДОСТУПНЕ ОНОВЛЕННЯ: 0.1.0 → 0.2.0"
```

---

### 3️⃣ Чи може він сам оновити програму на боці клієнта?

**ВІДПОВІДЬ: ЧАСТКОВО - завантажує, але НЕ встановлює**

```
┌──────────────────────────────────────────────────────┐
│ МОЖЛИВОСТІ ОНОВЛЕННЯ                                 │
├──────────────────────────────────────────────────────┤
│                                                      │
│ ✅ ЧТО РОБИТЬ:                                       │
│   1. Перевіряє GitHub на нову версію                 │
│   2. Завантажує новий VRL_Client.exe                 │
│   3. Зберігає його в папку 'downloads'              │
│   4. Показує користувачу інструкцію                  │
│                                                      │
│ ❌ ЧТО НЕ РОБИТЬ:                                    │
│   - НЕ замінює старий exe на новий автоматично      │
│   - НЕ перезапускає програму                        │
│   - НЕ видаляє старий файл                          │
│   - НЕ змінює системні файли (реєстр, сервіси)      │
│                                                      │
│ ЧОМУ?                                               │
│   - Безпека (користувач контролює процес)           │
│   - Уникаємо проблем з блокуванням файлів            │
│   - Windows часто блокує оновлення .exe на ходу     │
│                                                      │
└──────────────────────────────────────────────────────┘

СЦЕНАРІЙ ОНОВЛЕННЯ:

1. Користувач: python update_checker.py --download
   ↓
2. Програма завантажує новий exe
   ↓
3. Експортує в: vrl_client/downloads/VRL_Client.exe
   ↓
4. Показує повідомлення:
   "✅ ОНОВЛЕННЯ ГОТОВЕ!
    📂 Файл збережений: .../downloads/VRL_Client.exe
    🔧 Наступні кроки:
       1. Закрити поточну версію програми
       2. Замінити старий exe новим
       3. Запустити нову версію"
   ↓
5. Користувач ВРУЧНУ замінює файл
   ↓
6. config.yaml + base.db зберігаються (ТУЖ!!)
```

---

## 📋 ДЕТАЛЬНА ФУНКЦІОНАЛЬНІСТЬ

### Функція 1: `get_latest_release()`

```python
def get_latest_release():
    """Отримуємо інформацію про останній Release на GitHub"""
    response = requests.get(
        "https://api.github.com/repos/Hyrol7/vrl-client/releases/latest",
        timeout=10
    )
    return response.json()
```

**ЩО ПОВЕРТАЄ:**
```json
{
    "tag_name": "v0.2.0",
    "name": "Version 0.2.0",
    "body": "## Что нового\n- Улучшена парсинг K1/K2\n- Исправлены баги...",
    "assets": [
        {
            "name": "VRL_Client.exe",
            "browser_download_url": "https://github.com/..../VRL_Client.exe",
            "size": 75000000
        }
    ],
    "html_url": "https://github.com/Hyrol7/vrl-client/releases/tag/v0.2.0"
}
```

---

### Функція 2: `check_for_updates()`

```python
def check_for_updates(verbose=True):
    """Перевіряємо наявність оновлень"""
    release = get_latest_release()
    latest_version = parse_version(release['tag_name'])  # "v0.2.0" → "0.2.0"
    
    if version.parse(latest_version) > version.parse(LOCAL_VERSION):
        # Оновлення доступне!
        return release
    else:
        # Ти використовуєш останню версію
        return None
```

---

### Функція 3: `download_exe()`

```python
def download_exe(download_url, output_path):
    """Завантажуємо exe файл з GitHub"""
    response = requests.get(download_url, stream=True)
    
    # Показуємо прогрес:
    # [25.3%] 19.2MB / 75.0MB
    # [50.6%] 38.4MB / 75.0MB
    # [100.0%] 75.0MB / 75.0MB
    
    with open(output_path, 'wb') as f:
        for chunk in response.iter_content(chunk_size=8192):
            f.write(chunk)
```

---

## 🎯 ВИКОРИСТАННЯ

### Команда 1: Тільки перевірити

```bash
python update_checker.py

════════════════════════════════════════════════════════════
VRL CLIENT - ПЕРЕВІРКА ОНОВЛЕНЬ
════════════════════════════════════════════════════════════

🔍 Перевірка оновлень...
   Локальна версія: 0.1.0
   Остання версія:  0.2.0

✅ ДОСТУПНЕ ОНОВЛЕННЯ: 0.1.0 → 0.2.0

📝 Що нового:
   ## Version 0.2.0
   - Improved K1/K2 parsing algorithm
   - Fixed time synchronization...

📥 Файл для завантаження:
   VRL_Client.exe (75.2 MB)

🔗 Посилання:
   https://github.com/Hyrol7/vrl-client/releases/download/v0.2.0/VRL_Client.exe

🌐 GitHub Release:
   https://github.com/Hyrol7/vrl-client/releases/tag/v0.2.0

💡 Як оновити:
   1. Завантажити: python update_checker.py --download
   2. Замінити старий exe на новий
   3. config.yaml та base.db будуть збережені
```

---

### Команда 2: Перевірити та завантажити

```bash
python update_checker.py --download

════════════════════════════════════════════════════════════
ЗАВАНТАЖЕННЯ ОНОВЛЕННЯ
════════════════════════════════════════════════════════════

🔍 Перевірка оновлень...
   Локальна версія: 0.1.0
   Остання версія:  0.2.0

✅ ДОСТУПНЕ ОНОВЛЕННЯ: 0.1.0 → 0.2.0

📥 Завантаження VRL_Client.exe...
  [25.3%] 19.2MB / 75.0MB
  [50.6%] 38.4MB / 75.0MB
  [75.9%] 57.0MB / 75.0MB
  [100.0%] 75.2MB / 75.0MB

✅ Завантажено успішно: vrl_client/downloads/VRL_Client.exe

✅ ОНОВЛЕННЯ ГОТОВЕ!

📂 Файл збережений: .../vrl_client/downloads/VRL_Client.exe

🔧 Наступні кроки:
   1. Закрити поточну версію програми (якщо запущена)
   2. Замінити старий exe новим з папки 'downloads'
   3. Запустити нову версію
   4. config.yaml та base.db будуть на місці
```

---

## ⚠️ ВАЖНІ МОМЕНТИ

### Момент 1: Версія жорстко закодована

```python
LOCAL_VERSION = "0.1.0"  # Потрібно оновлювати вручну!
```

**СИНХРОНІЗАЦІЯ З vrl.py:**

Коли випускаємо нову версію:
1. Обновляємо `vrl.py`: `'version': '0.2.0'`
2. Обновляємо `update_checker.py`: `LOCAL_VERSION = "0.2.0"`
3. Робимо commit + tag
4. GitHub Actions автоматично будує exe

---

### Момент 2: Требует GitHub API доступа

Без інтернету не працює. Якщо є проблеми:

```
❌ ПОМИЛКА: Не можу під'єднатися до GitHub 
   (можливо немає інтернету)
```

---

### Момент 3: Файли конфігурації збережуються

```
БЕЗ ЗМІН:
  ✅ config.yaml     (параметри декодера, API, тощо)
  ✅ base.db         (вся історія даних)
  ✅ logs таблиця    (усі попередні логи)

ЗАМІНЮЄТЬСЯ:
  ❌ VRL_Client.exe  (новіша версія)
```

---

## 🔄 РЕКОМЕНДОВАНИЙ ЦИКЛ ОНОВЛЕННЯ

```
РОЗРОБНИК (мої дії):

1. Редагую код (parser.py, analyser.py, тощо)
   ↓
2. git add . && git commit -m "..."
   ↓
3. git push origin main
   ↓
4. git tag v0.2.0 && git push origin v0.2.0
   ↓
5. GitHub Actions автоматично:
   - Будує exe
   - Створює Release
   - Завантажує artifact


КОРИСТУВАЧ (твої дії):

1. Запускаю вже встановлену версію (0.1.0)
   ↓
2. Коли готов до оновлення:
   python update_checker.py
   ↓
3. Бачу: "0.1.0 → 0.2.0 доступне"
   ↓
4. Завантажую:
   python update_checker.py --download
   ↓
5. Вручну замінюю exe файл
   ↓
6. Запускаю нову версію
   ↓
7. config.yaml + base.db на місці! ✅
```

---

## 📊 МАТРИЦЯ: Поточна архітектура

| Компонент | Де розташований | Коли запускається | Що робит |
|-----------|-----------------|------------------|----------|
| vrl.py | Exe (запаковано) | При старті | Ініціалізація, ping loop |
| parser.py | Exe (запаковано) | Після TCP | Читання TCP від декодера |
| update_checker.py | Exe (запаковано) | **Вручну** | Перевірка оновлень |
| config.yaml | На диску | При старті | Параметри програми |
| base.db | На диску | При старті | Зберіганння даних |

---

## ✅ ЧЕК-ЛИСТ

- [x] update_checker.py правильно перевіряє GitHub
- [x] Завантажує ТІЛЬКИ exe файл
- [x] Показує прогрес завантаження
- [x] Зберігає в папку `downloads/`
- [x] НЕ встановлює автоматично (користувач замінює вручну)
- [x] config.yaml та base.db збережуються
- [x] Обробляє помилки (timeout, connection, тощо)
- [x] GitHub username встановлено на "Hyrol7"

---

**ВИСНОВОК:**

`update_checker.py` - це утиліта ДЛЯ КОРИСТУВАЧІВ, а не для розробників.

Запускається ВРУЧНУ, перевіряє GitHub Releases на нові exe файли, завантажує їх, але НЕ встановлює автоматично.

Це безпечно, зручно та зберігає конфіг!
